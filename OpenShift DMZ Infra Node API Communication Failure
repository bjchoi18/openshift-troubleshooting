# ğŸ§© OpenShift DMZ Infra Node API Communication Failure

### Kubernetes Architecture ê¸°ë°˜ Network Troubleshooting Case Study

---

## ğŸ“– Overview

DMZ ì˜ì—­ì— ìœ„ì¹˜í•œ OpenShift Infra Nodeì—ì„œ Kubernetes API ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•´ì§€ë©´ì„œ
DNS, Monitoring, Node Tuning ë“± Core Componentê°€ ì—°ì‡„ì ìœ¼ë¡œ ì¥ì• ë¥¼ ì¼ìœ¼í‚¨ ì‚¬ë¡€ì…ë‹ˆë‹¤.

ë³¸ ë¬¸ì„œëŠ” Kubernetes ê³µì‹ ì•„í‚¤í…ì²˜ì™€ Serviceâ€“Endpoint ë™ì‘ ì›ì¹™ì„ ê¸°ë°˜ìœ¼ë¡œ
ì‹¤ì œ Root Causeë¥¼ ë¶„ì„í•˜ê³  í•´ê²°í•œ Tech Case Studyì…ë‹ˆë‹¤.

---

## ğŸ— Environment

| Item         | Description                                 |
| ------------ | ------------------------------------------- |
| Platform     | Red Hat OpenShift Container Platform 4.18   |
| Network Zone | DMZ Infra Segment                           |
| Role         | OpenShift Platform Engineer                 |
| Scope        | Control Plane Communication Troubleshooting |

---

## ğŸš¨ Problem

### Symptoms

* DMZ Infra Node â†’ Kubernetes API ì ‘ê·¼ ë¶ˆê°€
* Service IP í†µì‹  ì‹¤íŒ¨ (10.x.x.1:443)
* Core Component ì¥ì•  ë°œìƒ

### Impacted Components

* DNS
* Monitoring
* Metrics
* Node Tuning
* Machine Config

### Network Observation

```
DMZ Infra â†’ Master 6443 : TIMEOUT
DMZ Infra â†’ Service IP 443 : TIMEOUT
```

---

## ğŸ” Investigation Approach

ì´ë²ˆ ì¥ì• ëŠ” ë‹¨ìˆœ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œê°€ ì•„ë‹Œ
**Kubernetes Control Plane Communication êµ¬ì¡° ì´í•´**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ§  Architecture Analysis

### 1ï¸âƒ£ All Control Communication Ends at kube-apiserver

```
Node / Pod
   â†“
kube-apiserver (6443)
```

API Server ì ‘ê·¼ ë¶ˆê°€ ì‹œ í´ëŸ¬ìŠ¤í„° ì œì–´ ê¸°ëŠ¥ì€ ì •ìƒ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

### 2ï¸âƒ£ Load Balancer is NOT Mandatory Path

ì˜ëª»ëœ ê°€ì •:

```
API í†µì‹ ì€ L4 LBë§Œ ì—´ë©´ ëœë‹¤
```

ì‹¤ì œ êµ¬ì¡°:

```
Node â†’ Master Direct Communication Required
```

Load BalancerëŠ” HA ë˜ëŠ” External Access ìš©ë„ì¼ ë¿ ë‚´ë¶€ í•„ìˆ˜ ê²½ë¡œê°€ ì•„ë‹™ë‹ˆë‹¤.

---

### 3ï¸âƒ£ Kubernetes Service is a Virtual Entry Point

```
Service IP (443)
     â†“
Endpoint â†’ kube-apiserver (6443)
```

Service IPëŠ” ë…¼ë¦¬ì  ì£¼ì†Œì´ë©°
Endpoint ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ë©´ Serviceë„ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

---

### 4ï¸âƒ£ kube-proxy Behavior

kube-proxy ì—­í• :

* Service íŠ¸ë˜í”½ Forwarding
* API Proxy ì•„ë‹˜
* Network ìš°íšŒ ê¸°ëŠ¥ ì—†ìŒ

---

### 5ï¸âƒ£ Node Configuration Pull Model

```
Node â†’ API Server â†’ Config Pull
```

API ì ‘ê·¼ ì°¨ë‹¨ ì‹œ:

* Node Tuning Waiting
* Machine Config ë¯¸ì ìš©

---

## ğŸ¯ Root Cause

DMZ ë°©í™”ë²½ ì •ì±…ì—ì„œ Infra Node â†’ Master Node ì§ì ‘ API í†µì‹ ì´ ì°¨ë‹¨ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.

ì°¨ë‹¨ í¬íŠ¸:

* TCP 6443 (Kubernetes API)
* TCP 22623 (Machine Config Server)

---

## ğŸ›  Resolution

### Firewall Rule Update

| Source         | Destination | Protocol | Port  | Purpose        |
| -------------- | ----------- | -------- | ----- | -------------- |
| DMZ Infra Node | Master Node | TCP      | 6443  | Kubernetes API |
| DMZ Infra Node | Master Node | TCP      | 22623 | Machine Config |

---

## âœ… Result

* API Server ì ‘ê·¼ ì •ìƒí™”
* Service IP í†µì‹  ë³µêµ¬
* OpenShift Core Component ìë™ ë³µêµ¬
* Cluster Healthy ìƒíƒœ íšŒë³µ

---

## ğŸ“Š Key Learnings

* Kubernetes ë‚´ë¶€ API í†µì‹ ì€ LB ì˜ì¡´ êµ¬ì¡°ê°€ ì•„ë‹˜
* Service IPëŠ” Virtual IPì´ë©° Endpoint ì ‘ê·¼ì´ í•µì‹¬
* Node ì„¤ì •ì€ Pushê°€ ì•„ë‹Œ Pull êµ¬ì¡°
* DMZ í™˜ê²½ì—ì„œë„ Node â†” Master Direct Path í•„ìˆ˜

---

## ğŸ’¼ Skills Demonstrated

* OpenShift Control Plane Deep Troubleshooting
* Kubernetes Networking Architecture ì´í•´
* DMZ Network Design Validation
* Service / Endpoint êµ¬ì¡° ê¸°ë°˜ Root Cause ë¶„ì„
* Enterprise ê¸ˆìœµê¶Œ í™˜ê²½ ëŒ€ì‘ ê²½í—˜

---

## ğŸ§© One-Line Summary

DMZ Infra Nodeì—ì„œ Master Node API í†µì‹  ì°¨ë‹¨ìœ¼ë¡œ ë°œìƒí•œ OpenShift Core ì¥ì• ë¥¼
Kubernetes ì•„í‚¤í…ì²˜ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í•˜ê³  Firewall ì •ì±… ìˆ˜ì •ìœ¼ë¡œ í•´ê²°í•œ ì‚¬ë¡€.

---
